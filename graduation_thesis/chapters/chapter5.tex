\chapter{编队控制飞行实验}%TODO:仿真需要给出控制器的相关参数，以及初始条件等等。
\label{chap:simulatin_expermient}
上一章介绍了无人机编队控制器的仿真环境，
则本章中，按照第\ref{chap:controller_design}
章中给出的控制器的数学模型，选定相应的初始条件进行双机的质点模型数学仿真：即不考虑无人机的姿态，只考虑无人机的位置，速度大小以及方向。
之后，利用第\ref{chap:hardware}章中介绍的$ROS/Gazebo-PX4$仿真环境，在考虑无人机动力学的条件下进行双机编队仿真。
\section{无人机软硬件环境选配}
本文所设计的编队控制器是以开源自动驾驶仪PX4的内环为基础的，PX4的内环自动驾驶仪运行在Pixhawk这一开源硬件之上，成为上层控制的下位机（slave computer）:
编队控制算法运行在具有ROS环境的上位机（host computer）中；
整体的软件硬件选配关系如下图所示：
\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{figures/c4/c4-soft-hard.png}
    \caption{硬件软件选配关系}\label{fig:c4-soft-hard.png}
\end{figure}
上位机（host computer）的选择主要由其性能决定，应满足ROS基本环境的正常运行以及编队控制算法的需求；其次应考虑该硬件的寿命，体积，工况
要求等指标。下位机（slave computer）是PX4等算法运行的介质，也是飞行之中的重要传感器如惯性原件（IMU）、磁罗盘以及定位模块（GPS Module）的
工作平台，选择时考虑其传感器精度，平台计算能力等因素；无人机是编队控制的载具平台，应根据上述硬件以及必要航电设备选择翼面积、起飞质量
有效载荷等重要参数；根据硬件安放位置选择合适的机舱外形；根据编队控制需要确定平飞速度；根据期望推力选择发动机型号；根据起飞降落方式
选择起落架类型。必要时，应根据性能要求以及指标设计无人机。

在实现无人机编队过程中，双机通信必不可少。通信模块相对于无人机系统相对独立，在此只介绍硬件实现的一种手段：通讯模块选用P900芯片，通讯协议
选用mavlink协议，驱动由ROS下的串口功能包“serial”提供；领机将自身的状态信息通过串口从其自动驾驶仪滤波之后的值中获取
，之后进行mavlink的编码，最后通过数传模块发送之后，接收端进行解包；实际双机编队飞行试验的硬件链接逻辑如下图所示：
\begin{figure}[H]
    \centering
    \includegraphics[width=1\textwidth]{figures/c4/double_plane_real}
    \caption{双机编队硬件链接}\label{fig:c4-double_plane_real}
\end{figure}

\section{本章小结}
本章的主要工作是对于前文所设计的编队控制器进行响应的仿真，共分为两部分：在第一部分，考虑无人机的质点运动模型，利用MATALB/Simulink等工具进行了
编队控制器的算法层面的数学仿真。第二部分，利用第\ref{chap:hardware}中所介绍的Gazebo仿真环境进行编队控制器的动力学仿真，并整定了相关控制器的
参数，证明了控制器的稳定性。
